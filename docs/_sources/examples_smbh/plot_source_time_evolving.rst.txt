
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples_smbh/plot_source_time_evolving.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_examples_smbh_plot_source_time_evolving.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_smbh_plot_source_time_evolving.py:


Time-evolving parameter estimation
=================================

Corner plot of select parameters for a single source showing how 
parameter estimation changes with observing time.

.. GENERATED FROM PYTHON SOURCE LINES 8-39

.. code-block:: default


    import glob
    import numpy as np
    import pandas as pd
    import matplotlib.pyplot as plt
    import lisacattools.lisacattools as lisacat
    from chainconsumer import ChainConsumer


    # Find the list of catalogs
    catFiles = glob.glob('MBH_wk*C.h5')

    # Read individual DataFrames' metadata by specifying the key parameter
    dfs = list()
    for catFile in catFiles:
        df = pd.read_hdf(catFile, key = 'metadata')
        df['location'] = catFile
        dfs.append(df) 
    meta = pd.concat(dfs)

    # sort metadata by observation week, putting most recent catalog last in the list
    meta = meta.sort_values(by='observation week')

    # load and display the detections, sorted by primary mass 
    catIdx = len(meta)-1
    catName = meta.index[catIdx]
    catFile = meta.iloc[catIdx]['location']
    cat = pd.read_hdf(catFile, key='detections')
    cat = cat.sort_values(by='Mass 1')
    cat






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Parent</th>
          <th>Log Likelihood</th>
          <th>Mass 1</th>
          <th>Mass 2</th>
          <th>Spin 1</th>
          <th>Spin 2</th>
          <th>Merger Phase</th>
          <th>Barycenter Merge Time</th>
          <th>Luminosity Distance</th>
          <th>cos ecliptic colatitude</th>
          <th>Ecliptic Longitude</th>
          <th>Polarization</th>
          <th>cos inclination</th>
          <th>Detector Merger Time</th>
          <th>Ecliptic Latitude</th>
          <th>chain file</th>
        </tr>
        <tr>
          <th>name</th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>MBH010993271</th>
          <td>MBH010993145</td>
          <td>58.644439</td>
          <td>6043.582334</td>
          <td>1484.773218</td>
          <td>0.824566</td>
          <td>0.580256</td>
          <td>1.571869</td>
          <td>1.099327e+07</td>
          <td>22.671702</td>
          <td>0.202097</td>
          <td>0.551582</td>
          <td>1.609824</td>
          <td>-0.711813</td>
          <td>10993320.0</td>
          <td>0.203499</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH006058694</th>
          <td>MBH006058694</td>
          <td>119.338404</td>
          <td>10349.085349</td>
          <td>3303.282920</td>
          <td>0.967010</td>
          <td>0.885836</td>
          <td>1.614070</td>
          <td>6.058695e+06</td>
          <td>47.235091</td>
          <td>0.333101</td>
          <td>1.464468</td>
          <td>1.373326</td>
          <td>-0.442646</td>
          <td>6058450.0</td>
          <td>0.339590</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH000373540</th>
          <td></td>
          <td>60.282950</td>
          <td>11191.400618</td>
          <td>1573.347120</td>
          <td>0.912502</td>
          <td>0.627869</td>
          <td>1.555474</td>
          <td>3.735402e+05</td>
          <td>22.205113</td>
          <td>0.288597</td>
          <td>2.336538</td>
          <td>1.684530</td>
          <td>-0.316716</td>
          <td>373452.5</td>
          <td>0.292761</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH002301433</th>
          <td></td>
          <td>67.615841</td>
          <td>12659.907280</td>
          <td>3912.600441</td>
          <td>0.961883</td>
          <td>0.867574</td>
          <td>1.575534</td>
          <td>2.301434e+06</td>
          <td>34.400859</td>
          <td>0.373100</td>
          <td>1.242727</td>
          <td>1.585468</td>
          <td>-0.013747</td>
          <td>2301210.0</td>
          <td>0.382348</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH005546845</th>
          <td>MBH005546845</td>
          <td>652.996924</td>
          <td>13238.473697</td>
          <td>2707.606755</td>
          <td>0.986599</td>
          <td>0.903154</td>
          <td>1.673776</td>
          <td>5.546846e+06</td>
          <td>30.323258</td>
          <td>0.480294</td>
          <td>3.662275</td>
          <td>1.810179</td>
          <td>-0.800118</td>
          <td>5547205.0</td>
          <td>0.500989</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH004556400</th>
          <td>MBH004556400</td>
          <td>243.337498</td>
          <td>15868.967713</td>
          <td>9036.333963</td>
          <td>0.977598</td>
          <td>0.962171</td>
          <td>1.671275</td>
          <td>4.556400e+06</td>
          <td>28.921349</td>
          <td>0.756914</td>
          <td>0.471104</td>
          <td>1.576525</td>
          <td>-0.410775</td>
          <td>4556105.0</td>
          <td>0.858578</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH004650719</th>
          <td>MBH004650719</td>
          <td>446.562104</td>
          <td>22450.923508</td>
          <td>8796.170612</td>
          <td>0.974075</td>
          <td>0.933973</td>
          <td>1.493337</td>
          <td>4.650720e+06</td>
          <td>59.148264</td>
          <td>-0.182069</td>
          <td>1.626839</td>
          <td>1.601119</td>
          <td>0.460113</td>
          <td>4650671.0</td>
          <td>-0.183090</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH001865195</th>
          <td>MBH001865195</td>
          <td>164.506458</td>
          <td>24034.822836</td>
          <td>8748.509775</td>
          <td>0.972429</td>
          <td>0.918015</td>
          <td>2.297636</td>
          <td>1.865195e+06</td>
          <td>95.079793</td>
          <td>0.195796</td>
          <td>3.250084</td>
          <td>2.404726</td>
          <td>-0.500549</td>
          <td>1864860.0</td>
          <td>0.197069</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH007449510</th>
          <td>MBH007449510</td>
          <td>72.207804</td>
          <td>38276.504295</td>
          <td>2615.575967</td>
          <td>0.970797</td>
          <td>0.368108</td>
          <td>1.559661</td>
          <td>7.449511e+06</td>
          <td>100.930430</td>
          <td>-0.682983</td>
          <td>0.640946</td>
          <td>1.612438</td>
          <td>0.667808</td>
          <td>7449392.0</td>
          <td>-0.751839</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH006253789</th>
          <td>MBH006253789</td>
          <td>260.016246</td>
          <td>51499.191655</td>
          <td>5166.812496</td>
          <td>0.990408</td>
          <td>0.815457</td>
          <td>1.460127</td>
          <td>6.253789e+06</td>
          <td>24.506354</td>
          <td>0.592016</td>
          <td>6.084030</td>
          <td>1.503608</td>
          <td>-0.374348</td>
          <td>6253739.0</td>
          <td>0.633558</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH011318669</th>
          <td>MBH011317078</td>
          <td>740.270521</td>
          <td>142698.356416</td>
          <td>31498.663144</td>
          <td>0.880107</td>
          <td>0.685761</td>
          <td>1.572697</td>
          <td>1.131867e+07</td>
          <td>13.886229</td>
          <td>0.788169</td>
          <td>4.306482</td>
          <td>1.567044</td>
          <td>-0.831652</td>
          <td>11318750.0</td>
          <td>0.907828</td>
          <td>MBH_wk015C.h5</td>
        </tr>
        <tr>
          <th>MBH007807200</th>
          <td>MBH007807200</td>
          <td>189597.629550</td>
          <td>641359.177017</td>
          <td>83719.952286</td>
          <td>0.988151</td>
          <td>0.986588</td>
          <td>0.975498</td>
          <td>7.807201e+06</td>
          <td>14.897055</td>
          <td>0.981188</td>
          <td>4.567808</td>
          <td>1.592036</td>
          <td>-0.570242</td>
          <td>7807296.0</td>
          <td>1.376523</td>
          <td>MBH_wk015C.h5</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 40-41

Choose a source from the list of detections and get its history through the different catalogs

.. GENERATED FROM PYTHON SOURCE LINES 41-51

.. code-block:: default


    # Pick a source, any source
    sourceIdx = 'MBH005546845'

    # Get source history and display table with parameters and observing weeks containing source
    srcHist = lisacat.getLineage(meta,catName,sourceIdx)
    srcHist.drop_duplicates(subset='Log Likelihood',keep='last',inplace=True)
    srcHist.sort_values(by='Observation Week',ascending=True,inplace=True)
    srcHist






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Observation Week</th>
          <th>Catalog</th>
          <th>Parent</th>
          <th>Log Likelihood</th>
          <th>Mass 1</th>
          <th>Mass 2</th>
          <th>Spin 1</th>
          <th>Spin 2</th>
          <th>Merger Phase</th>
          <th>Barycenter Merge Time</th>
          <th>Luminosity Distance</th>
          <th>cos ecliptic colatitude</th>
          <th>Ecliptic Longitude</th>
          <th>Polarization</th>
          <th>cos inclination</th>
          <th>Detector Merger Time</th>
          <th>Ecliptic Latitude</th>
          <th>chain file</th>
        </tr>
        <tr>
          <th>name</th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>MBH005540184</th>
          <td>4.0</td>
          <td>MBHcatalog_week004</td>
          <td></td>
          <td>69.186329</td>
          <td>9058.387458</td>
          <td>3656.104345</td>
          <td>0.447972</td>
          <td>0.265300</td>
          <td>1.583827</td>
          <td>5.540184e+06</td>
          <td>32.844051</td>
          <td>0.289695</td>
          <td>3.123233</td>
          <td>1.606603</td>
          <td>-0.780413</td>
          <td>5540173.0</td>
          <td>0.293908</td>
          <td>MBH_wk004C.h5</td>
        </tr>
        <tr>
          <th>MBH005542433</th>
          <td>5.0</td>
          <td>MBHcatalog_week005</td>
          <td>MBH005540184</td>
          <td>105.454620</td>
          <td>11341.213640</td>
          <td>3043.851925</td>
          <td>0.731180</td>
          <td>0.104110</td>
          <td>1.579964</td>
          <td>5.542433e+06</td>
          <td>32.564748</td>
          <td>0.158864</td>
          <td>3.025568</td>
          <td>1.593242</td>
          <td>-0.697670</td>
          <td>5542380.0</td>
          <td>0.159540</td>
          <td>MBH_wk005C.h5</td>
        </tr>
        <tr>
          <th>MBH005546150</th>
          <td>6.0</td>
          <td>MBHcatalog_week006</td>
          <td>MBH005542433</td>
          <td>155.709338</td>
          <td>19916.458243</td>
          <td>2004.123403</td>
          <td>0.865485</td>
          <td>0.233904</td>
          <td>1.572732</td>
          <td>5.546150e+06</td>
          <td>31.018574</td>
          <td>0.205724</td>
          <td>3.256753</td>
          <td>1.604540</td>
          <td>-0.761606</td>
          <td>5546153.0</td>
          <td>0.207203</td>
          <td>MBH_wk006C.h5</td>
        </tr>
        <tr>
          <th>MBH005546439</th>
          <td>7.0</td>
          <td>MBHcatalog_week007</td>
          <td>MBH005546150</td>
          <td>226.169428</td>
          <td>21528.119205</td>
          <td>1896.116706</td>
          <td>0.847665</td>
          <td>0.298423</td>
          <td>1.572021</td>
          <td>5.546440e+06</td>
          <td>30.882839</td>
          <td>0.311239</td>
          <td>3.377012</td>
          <td>1.575915</td>
          <td>-0.786457</td>
          <td>5546478.0</td>
          <td>0.316496</td>
          <td>MBH_wk007C.h5</td>
        </tr>
        <tr>
          <th>MBH005546810</th>
          <td>8.0</td>
          <td>MBHcatalog_week008</td>
          <td>MBH005546439</td>
          <td>332.303904</td>
          <td>20199.039472</td>
          <td>1984.569259</td>
          <td>0.887979</td>
          <td>0.309512</td>
          <td>1.576428</td>
          <td>5.546810e+06</td>
          <td>30.559129</td>
          <td>0.337593</td>
          <td>3.491147</td>
          <td>1.613373</td>
          <td>-0.788486</td>
          <td>5547041.0</td>
          <td>0.344359</td>
          <td>MBH_wk008C.h5</td>
        </tr>
        <tr>
          <th>MBH005546759</th>
          <td>9.0</td>
          <td>MBHcatalog_week009</td>
          <td>MBH005546810</td>
          <td>523.048089</td>
          <td>16537.055819</td>
          <td>2292.503512</td>
          <td>0.937927</td>
          <td>0.548418</td>
          <td>1.573987</td>
          <td>5.546760e+06</td>
          <td>31.031316</td>
          <td>0.463161</td>
          <td>3.639771</td>
          <td>1.638381</td>
          <td>-0.819428</td>
          <td>5547100.0</td>
          <td>0.481558</td>
          <td>MBH_wk009C.h5</td>
        </tr>
        <tr>
          <th>MBH005546845</th>
          <td>10.0</td>
          <td>MBHcatalog_week010</td>
          <td>MBH005546759</td>
          <td>652.996924</td>
          <td>13238.473697</td>
          <td>2707.606755</td>
          <td>0.986599</td>
          <td>0.903154</td>
          <td>1.673776</td>
          <td>5.546846e+06</td>
          <td>30.323258</td>
          <td>0.480294</td>
          <td>3.662275</td>
          <td>1.810179</td>
          <td>-0.800118</td>
          <td>5547205.0</td>
          <td>0.500989</td>
          <td>MBH_wk010C.h5</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 52-53

Load chains for different observing epochs of selected source

.. GENERATED FROM PYTHON SOURCE LINES 53-63

.. code-block:: default

    epochs = list(srcHist.index)
    dfs = list()
    for epoch in epochs:
        df = lisacat.getChain(srcHist,epoch)
        df.insert(len(df.columns),'Source',epoch,True)
        df.insert(len(df.columns),'Observation Week',srcHist.loc[epoch]['Observation Week'],True)
        dfs.append(df[['Source','Observation Week','Mass 1','Mass 2','Spin 1','Spin 2','Ecliptic Latitude','Ecliptic Longitude','Luminosity Distance','Barycenter Merge Time','Merger Phase','Polarization', 'cos inclination']])

    allEpochs = pd.concat(dfs)








.. GENERATED FROM PYTHON SOURCE LINES 64-65

Create corner for multiple observing epochs

.. GENERATED FROM PYTHON SOURCE LINES 65-94

.. code-block:: default


    # Choose weeks for plot from source history table
    wks = [4,8,10]

    # select subset of parameters to plot
    parameters = ['Mass 1','Mass 2','Luminosity Distance']
    parameter_labels = [r'$m_1\ [{\rm M}_\odot]$',
                        r'$m_2\ [{\rm M}_\odot]$',
                        r'$D_L\ [{\rm Gpc}]$',
                       ]
    ranges=[(10000,50000),
            (1000,5000),
            (16,40)]

    c = ChainConsumer()
    for idx,wk in enumerate(wks):
        epoch = allEpochs[allEpochs['Observation Week']==wk]
        samples = epoch[parameters].values

        c.add_chain(samples,parameters=parameter_labels,name='Week '+str(wk))

    c.configure(cmap="plasma")
    fig = c.plotter.plot(figsize=1.5, log_scales=False, extents=ranges)









.. image:: /examples_smbh/images/sphx_glr_plot_source_time_evolving_001.png
    :alt: plot source time evolving
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    WARNING:chainconsumer:Parameter $m_2\ [{\rm M}_\odot]$ in chain Week 4 is not constrained





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  9.810 seconds)


.. _sphx_glr_download_examples_smbh_plot_source_time_evolving.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_source_time_evolving.py <plot_source_time_evolving.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_source_time_evolving.ipynb <plot_source_time_evolving.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
